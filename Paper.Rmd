---
title: "Urbanization and Public Transportation of Los Angeles"
author: "Kainoa Kanter, Julian Jacobson, Aidan Allen"
date: "`r format(Sys.time(), '%B %d, %Y')`"
geometry: margin=1in
abstract: "This paper will examine how Los Angeles's demand for public transportation has been affected the last few years, utilizing derivatives to determine the rate of change in public transportation usage and studying the elasticity of demand for transportation options based on pricing, availability, convenience, and modes."
output:
  pdf_document:
    extra_dependencies: ['amsmath']
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
library(ggplot2)
library(latex2exp)
library(dplyr)
library(tidyr)
library(scales)
library(stargazer)
ridership_data <- read.csv("data/April_Transit_Ridership.csv")
population_data <- read.csv("data/Los_Angeles_Population.csv")
budget_data <- read.csv("data/City_Budget_Expenditures_on_Transportation_20231106.csv")
```

# Introduction

Los Angeles -- the sprawling metropolis that we call home -- has become synonymous with both opportunity and urban challenges and has experienced rapid growth in recent decades. This growth has significant implications for various sectors, particularly the public transportation system. As one of the most car-dependent cities in the United States, Los Angeles faces unique challenges in scaling its public transportation network to meet increasing demand. Understanding the dynamics of public transportation usage and the factors influencing ridership is critical for planning and policy development.

Testhfgg

The aim of this study is to examine how the rapid growth of Los Angeles affects the demand for public transportation. The investigation includes a quantitative assessment utilizing derivatives to determine the rate of change in public transportation usage. Additionally, the study examines the elasticity of demand for transportation options in Los Angeles based on pricing, availability, convenience, and modes. This analysis offers insights into the responsiveness of ridership to changes in these factors, informing strategies to enhance the public transportation system.

## Methodology

### Data Collection

The analysis is based on comprehensive datasets including average weekend and weekday ridership from 2019 to 2023, as well as a range of urban metrics such as crime rates, accident statistics, and city maintenance records. Yearly transportation budget figures also contribute to understanding the financial aspects influencing public transportation operations.

The methodological approach consists of two primary quantitative analyses:

#### Rate of Change Analysis:

-   Utilize time-series data to calculate the first derivative of ridership numbers, yielding the rate of change over the years. This derivative analysis will be conducted separately for bus and rail services, offering a granular view of usage trends.
-   Data transformation into a suitable format for analysis using the tidyverse collection of R packages.
-   Visualization of trends through line plots, elucidating patterns and growth trajectories.

#### Elasticity of Demand Analysis:

-   Analyze the responsiveness of public transportation demand to changes in price (fare changes), availability (service hours, frequency), convenience (route changes, wait times), and modes (bus vs. rail).

-   Employ econometric modeling to estimate the price elasticity of demand, cross-elasticity, and income elasticity, using regression analysis where ridership

#### Visualization

-   Data visualization was implemented using the `ggplot2` package in R
-   Line plots were created to illustrate the trends in public transportation ridership over time, broken down by transportation type (bus and rail)
-   Adjustments were made to display actual numbers instead of scientific notation for clarity

\newpage

# Exploratory Data Analysis

```{r rate-of-change-plot, fig.cap="Line plot of rate of change in public transportation ridership over time"}
ridership_long <- gather(ridership_data, key = "Type", value = "RateOfChange", -Year)

# Create the line plot
ggplot(ridership_long, aes(x=Year, y=RateOfChange, color=Type, group=Type)) +
  geom_line() +
  scale_y_continuous(labels = label_comma()) +
  labs(title="Trend in Rate of Change of Public Transportation Usage",
       x="April of Each Year",
       y="Rate of Change in Total Monthly Ridership",
       color="Transportation Type") +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 5), limits = c(2019, 2023))
```

\newpage

# Derivative Analysis

The rate of change in public transportation usage offers valuable insights into trends and can help forecast future demand. By differentiating the ridership data with respect to time, we can obtain the instantaneous rate of change, which is expressed mathematically as:

$$
R'(t) = \frac{dR}{dt}
$$

where $R(t)$ represents the ridership at time $t$. This derivative analysis provides the velocity of ridership change, indicating whether usage is increasing or decreasing over time.

```{r rate-of-change-and-regression}
# Derivative Analysis and Regression
# Calculate the rate of change for Total Monthly Bus and Rail
ridership_data$BusRateOfChange <- c(NA, diff(ridership_data$Total.Monthly.Bus))
ridership_data$RailRateOfChange <- c(NA, diff(ridership_data$Total.Monthly.Rail))

# Simple linear regression on the rate of change
bus_model <- lm(BusRateOfChange ~ Year, data = ridership_data)
rail_model <- lm(RailRateOfChange ~ Year, data = ridership_data)

# Polynomial regression on the rate of change
bus_model_poly <- lm(BusRateOfChange ~ poly(Year, 2, raw=TRUE), data = ridership_data)
rail_model_poly <- lm(RailRateOfChange ~ poly(Year, 2, raw=TRUE), data = ridership_data)

# Predict the rate of change for the fitted models
ridership_data$PredictedBusROC <- predict(bus_model, newdata=ridership_data)
ridership_data$PredictedRailROC <- predict(rail_model, newdata=ridership_data)

# Predict the rate of change for the fitted polynomial models
ridership_data$PredictedBusROC_poly <- predict(bus_model_poly, newdata=ridership_data)
ridership_data$PredictedRailROC_poly <- predict(rail_model_poly, newdata=ridership_data)

# Normalize the ridership data with the population data to get ridership per capita
ridership_data <- ridership_data %>%
  left_join(population_data, by = "Year") %>%
  mutate(
    RidershipPerCapitaBus = Total.Monthly.Bus / population,
    RidershipPerCapitaRail = Total.Monthly.Rail / population
  )

# Calculate the rate of change for Ridership per Capita
ridership_data$BusRateOfChangePerCapita <- c(NA, diff(ridership_data$RidershipPerCapitaBus))
ridership_data$RailRateOfChangePerCapita <- c(NA, diff(ridership_data$RidershipPerCapitaRail))

# Linear and polynomial regression for ridership per capita
bus_model_per_capita <- lm(BusRateOfChangePerCapita ~ Year, data = ridership_data)
rail_model_per_capita <- lm(RailRateOfChangePerCapita ~ Year, data = ridership_data)
```

```{r regression-results, results='asis'}
# Regression Results
stargazer(bus_model, rail_model, type = "latex", title = "Linear Regression Results", header=FALSE, omit=c("Year","Constant"))
stargazer(bus_model_poly, rail_model_poly, type = "latex", title = "Polynomial Regression Results", header=FALSE, omit=c("poly","Constant"))
```

```{r predict-trend-usage}
# Predict the rate of change per capita for all years using the linear and polynomial models
# (This assumes you have a model fitted to per capita data)
all_years <- data.frame(Year = seq(min(ridership_data$Year), 2027))
all_years <- left_join(all_years, population_data, by = "Year")

all_years$PredictedBusROCPerCapita <- predict(bus_model_per_capita, newdata=all_years)
all_years$PredictedRailROCPerCapita <- predict(rail_model_per_capita, newdata=all_years)

# Assuming the rate of change per capita is per year, integrate the rate of change to get the total ridership per capita
first_known_bus_ridership_per_capita <- head(ridership_data$RidershipPerCapitaBus, 1)
first_known_rail_ridership_per_capita <- head(ridership_data$RidershipPerCapitaRail, 1)

all_years$RidershipPerCapitaBus <- first_known_bus_ridership_per_capita + cumsum(c(0, all_years$PredictedBusROCPerCapita[-1]))
all_years$RidershipPerCapitaRail <- first_known_rail_ridership_per_capita + cumsum(c(0, all_years$PredictedRailROCPerCapita[-1]))
```

```{r format-and-combine-data}
# Format and Combine Data
# Convert the predicted data to long format
predicted_data_long <- all_years %>%
  select(Year, RidershipPerCapitaBus, RidershipPerCapitaRail) %>%
  pivot_longer(cols = c("RidershipPerCapitaBus", "RidershipPerCapitaRail"),
               names_to = "Type",
               values_to = "TotalRidership") %>%
  mutate(Prediction = "Predicted")

# Now, make sure the actual data is in the same long format with the same column names
actual_data_long <- ridership_data %>%
  select(Year, RidershipPerCapitaBus, RidershipPerCapitaRail) %>%
  pivot_longer(cols = c("RidershipPerCapitaBus", "RidershipPerCapitaRail"),
               names_to = "Type",
               values_to = "TotalRidership") %>%
  mutate(Prediction = "Actual")

# Combine the actual and predicted data
combined_data_long <- rbind(actual_data_long, predicted_data_long)

# Filter out the extreme predicted values for the polynomial bus data
combined_data_long <- combined_data_long %>%
  filter(!(Type == "RidershipPerCapitaBus" & TotalRidership < -10000000 & Prediction == "Predicted"))

```

```{r plot-trend-usage, fig.cap="Line plot of public transportation ridership over time with regression lines"}
# Create the line plot with observed and predicted per capita data
p <- ggplot(combined_data_long, aes(x = Year, y = RidershipPerCapita, color = Type)) +
  geom_line(aes(linetype = Prediction)) +
  scale_y_continuous(labels = scales::label_comma()) +
  labs(title = "Trend in Public Transportation Usage Per Capita",
       x = "April of Each Year",
       y = "Ridership Per Capita",
       color = "Transportation Type",
       linetype = "Data Type") +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10), limits = c(min(ridership_data$Year), max(all_years$Year)))

# Print the plot
print(p)

```

\newpage

# Sources:

- Transit ridership data: Los Angeles Metro "L.A. METRO TRANSIT RIDERSHIP UP 10 PERCENT, SETS POST-PANDEMIC RECORD", Patrick Chandler

- Los Angeles Population Data (real and predicted): WorldPopulationReview "Los Angeles, California Population"